using Markdig;
using Markdig.SyntaxHighlighting;
using MdHub.ViewModels;
using Microsoft.UI.Xaml;
using Microsoft.UI.Xaml.Controls;
using Microsoft.UI.Xaml.Controls.Primitives;
using Microsoft.UI.Xaml.Data;
using Microsoft.UI.Xaml.Input;
using Microsoft.UI.Xaml.Media;
using Microsoft.UI.Xaml.Navigation;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Numerics;
using System.Runtime.InteropServices.WindowsRuntime;
using Windows.Foundation;
using Windows.Foundation.Collections;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace MdHub.Views
{
    /// <summary>
    /// An empty page that can be used on its own or navigated to within a Frame.
    /// </summary>
    public sealed partial class DocumentView : Page
    {
        private const string TestMd = "This control was originally written by [Quinn Damerell](https://github.com/QuinnDamerell) and [Paul Bartrum](https://github.com/paulbartrum) for [Baconit](https://github.com/QuinnDamerell/Baconit), a popular open source reddit UWP. The control *almost* supports the full markdown syntax, with a focus on super-efficient parsing and rendering. The control is efficient enough to be used in virtualizing lists.\r\n\r\n*Note:* For a full list of markdown syntax, see the [official syntax guide](http://daringfireball.net/projects/markdown/syntax).\r\n\r\n&nbsp;\r\n\r\n**Try it live!** Type in the *unformatted text box* above!\r\n\r\n&nbsp;\r\n\r\n# COMMENTS\r\n\r\nComments can be added in Markdown, and they won't be rendered to the screen.\r\n\r\nTo create a comment, enclose in XML style comment tags:\r\n\r\n><\\!-- Comments are now Implemented -->\r\n\r\nThere is a Comment below this line.\r\n<!-- Comments are now Implemented -->\r\n\r\n&nbsp;\r\n\r\n# PARAGRAPHS\r\n\r\nParagraphs are delimited by a blank line.  Simply starting text on a new line won't create a new paragraph; It will remain on the same line in the final, rendered version as the previous line.  You need an extra, blank line to start a new paragraph.  This is especially important when dealing with quotes and, to a lesser degree, lists.\r\n\r\nYou can also add non-paragraph line breaks by ending a line with two spaces.  The difference is subtle:\r\n\r\nParagraph 1, Line 1\r\nParagraph 1, Line 2\r\n\r\nParagraph 2\r\n\r\n*****\r\n\r\n# FONT FORMATTING\r\n### Italics\r\n\r\nText can be displayed in an italic font by surrounding a word or words with either single asterisks (\\*) or single underscores (\\_).\r\n\r\nFor example:\r\n\r\n>This sentence includes \\*italic text\\*.\r\n\r\nis displayed as:\r\n\r\n>This sentence includes *italic text*.\r\n\r\n\r\n### Bold\r\n\r\nText can be displayed in a bold font by surrounding a word or words with either double asterisks (\\*) or double underscores (\\_).\r\n\r\nFor example:\r\n\r\n>This sentence includes \\*\\*bold text\\*\\*.\r\n\r\nis displayed as:\r\n\r\n>This sentence includes **bold text**.\r\n\r\n### Bold & Italics\r\n\r\nText can be displayed in a bold font by surrounding a word or words with either triple asterisks (\\*) or triple underscores (\\_).\r\n\r\nFor example:\r\n\r\n>This sentence includes \\*\\*\\*bold & italic text\\*\\*\\*.\r\n\r\nis displayed as:\r\n\r\n>This sentence includes ***bold & italic text***.\r\n\r\n### Strikethrough\r\n\r\nText can be displayed in a strikethrough font by surrounding a word or words with double tildes (~~).  For example:\r\n\r\n>This sentence includes ~ ~strikethrough text~ ~\r\n\r\n>*(but with no spaces between the tildes; escape sequences [see far below] appear not to work with tildes, so I can't demonstrate the exact usage).*\r\n\r\nis displayed as:\r\n\r\n>This sentence includes ~~strikethrough text~~.\r\n\r\n### Superscript\r\n\r\nText can be displayed in a superscript font by preceding it with a caret ( ^ ).\r\n\r\n>This sentence includes super^ script\r\n\r\n>*(but with no spaces after the caret; Like strikethrough, the superscript syntax doesn't play nicely with escape sequences).*\r\n\r\nis displayed as:\r\n\r\n>This sentence includes super^script.\r\n\r\nSuperscripts can even be nested: just^like^this .\r\n\r\nHowever, note that the superscript font will be reset by a space.  To get around this, you can enclose the text in the superscript with parentheses.  The parentheses won't be displayed in the comment, and everything inside of them will be superscripted, regardless of spaces:\r\n\r\n>This sentence^ (has a superscript with multiple words)\r\n\r\n>*Once again, with no space after the caret.*\r\n\r\nis displayed as\r\n\r\n>This sentence^(has a superscript with multiple words)\r\n\r\n### Subscript\r\n\r\nText can be displayed in a subscript font by preceding it with a caret ( <sub></sub> ).\r\n\r\n>This sentence includes \\<sub>sub\\</sub> script\r\n\r\n>This sentence includes <sub>sub</sub>script.\r\n\r\n### Headers\r\n\r\nMarkdown supports 6 levels of headers (some of which don't actually display as headers in reddit):\r\n\r\n#Header 1\r\n\r\n##Header 2\r\n\r\n###Header 3\r\n\r\n####Header 4\r\n\r\n#####Header 5\r\n\r\n######Header 6\r\n\r\n...which can be created in a couple of different ways.  Level 1 and 2 headers can be created by adding a line of equals signs (=) or dashes (\\-), respectively, underneath the header text.\r\n\r\nHowever, *all* types of headers can be created with a second method.  Simply prepend a number of hashes (#) corresponding to the header level you want, so:\r\n\r\n>\\# Header 1\r\n\r\n>\\#\\# Header 2\r\n\r\n>\\#\\#\\# Header 3\r\n\r\n>\\#\\#\\#\\# Header 4\r\n\r\n>\\#\\#\\#\\#\\# Header 5\r\n\r\n>\\#\\#\\#\\#\\#\\# Header 6\r\n\r\nresults in:\r\n\r\n>#Header 1\r\n\r\n>##Header 2\r\n\r\n>###Header 3\r\n\r\n>####Header 4\r\n\r\n>#####Header 5\r\n\r\n>######Header 6\r\n\r\nNote: you can add hashes after the header text to balance out how the source code looks without affecting what is displayed. So:\r\n\r\n>\\#\\# Header 2 ##\r\n\r\nalso produces:\r\n\r\n>## Header 2\r\n\r\n\r\n*****\r\n# LISTS\r\n\r\nMarkdown supports two types of lists: ordered and unordered.\r\n\r\n### Unordered Lists\r\n\r\nPrepend each element in the list with either a plus (+), dash (-), or asterisk (*) plus a space.  Line openers can be mixed.  So\r\n\r\n>\\* Item 1\r\n\r\n>\\+ Item 2\r\n\r\n>\\- Item 3\r\n\r\nresults in\r\n\r\n>* Item 1\r\n>+ Item 2\r\n>- Item 3\r\n\r\n\r\n\r\n### Ordered Lists\r\n\r\nOrdered lists work roughly the same way, but you prepend each item in the list with a number plus a period (.) plus a space.  Also, it makes no difference what numbers you use.  The ordered list will always start with the number 1, and will always increment sequentially.  So\r\n\r\n>7\\. Item 1\r\n\r\n>2\\. Item 2\r\n\r\n>5\\. Item 3\r\n\r\nresults in\r\n\r\n>7. Item 1\r\n>2. Item 2\r\n>5. Item 3\r\n\r\nAlso, you can nest lists, like so:\r\n\r\n1. Ordered list item 1\r\n\r\n2. * Bullet 1 in list item 2\r\n    * Bullet 2 in list item 2\r\n\r\n3. List item 3\r\n\r\nNote: If your list items consist of multiple paragraphs, you can force each new paragraph to remain in the previous list item by indenting it by one tab or four spaces.  So\r\n\r\n>\\* This item has multiple paragraphs.\r\n>\r\n>(*four spaces here*)This is the second paragraph\r\n>\r\n>\\* Item 2\r\n\r\nresults in:\r\n\r\n>* This item has multiple paragraphs.\r\n>\r\n>    This is the second paragraph\r\n>* Item 2\r\n\r\nNotice how the spaces in my source were stripped out?  What if you need to preserve formatting?  That brings us to:\r\n\r\n*****\r\n\r\n# CODE BLOCKS AND INLINE CODE\r\n\r\nInline code is easy.  Simply surround any text with backticks (\\`), **not to be confused with apostrophes (')**.  Anything between the backticks will be rendered in a fixed-width font, and none of the formatting syntax we're exploring will be applied.  So\r\n\r\n>Here is some `` ` ``inline code with \\*\\*formatting\\*\\*`` ` ``\r\n\r\nis displayed as:\r\n\r\n>Here is some `inline code with **formatting**`\r\n\r\nNote that this is why you should use the normal apostrophe when typing out possessive nouns or contractions.  Otherwise you may end up with something like:\r\n\r\n>I couldn`t believe that he didn`t know that!\r\n\r\nSometimes you need to preserve indentation, too.  In those cases, you can create a block code element by starting every line of your code with four spaces (followed by other spaces that will be preserved).  You can get results like the following:\r\n\r\n    public void main(Strings argv[]){\r\n        System.out.println(\"Hello world!\");\r\n    }\r\n\r\nStarting with Windows Community Toolkit v1.4, you can also use GitHub code notification by creating a block surrounded by 3x\\` (3 backticks). This can also be used with Language Identifiers on the entering backticks, such as:\r\n\r\n\\`\\`\\`csharp\r\n\r\npublic static void Main(string[] args)\r\n{\r\n  Console.WriteLine(\"Hello world!\");\r\n}\r\n\r\n\\`\\`\\`\r\n\r\nwill produce:\r\n\r\n```csharp\r\npublic static void Main(string[] args)\r\n{\r\n  Console.WriteLine(\"Hello world!\");\r\n}\r\n```\r\n\r\n*You can implement your own Syntax Highlighting or override the built in Highlighting with the `CodeBlockResolving` event. The Syntax Highlighting Style can be changed by setting the `StyleDictionary` on the `CodeStyling` Property.*\r\n\r\nAs an example of CodeBlockResolving, a Custom Identifier has been created, to make text Red and Bold:\r\n\r\n\\`\\`\\`CUSTOM\r\n\r\nThis is very angry.\r\n\r\n\\`\\`\\`\r\n\r\nmakes\r\n\r\n```CUSTOM\r\nThis is very angry.\r\n```\r\n\r\nSee the Code Page for an implementation example.\r\n\r\n*****\r\n\r\n# LINKS\r\n\r\nThere are a couple of ways to get HTML links.  The easiest is to just paste a valid URL, which will be automatically parsed as a link.  Like so:\r\n\r\n>http://en.wikipedia.org\r\n\r\nHowever, usually you'll want to have text that functions as a link.  In that case, include the text inside of square brackets followed by the URL in parentheses. So:\r\n\r\n>\\[Wikipedia\\]\\(http\\://en.wikipedia.org).\r\n\r\nresults in:\r\n\r\n>[Wikipedia](http://en.wikipedia.org).\r\n\r\nYou can also provide tooltip text for links like so:\r\n\r\n>\\[Wikipedia\\]\\(http\\://en.wikipedia.org \"tooltip text\"\\).\r\n\r\nresults in:\r\n\r\n>[Wikipedia](http://en.wikipedia.org \"tooltip text\").\r\n\r\nThere are other methods of generating links that aren't appropriate for discussion-board style comments.  See the [Markdown Syntax](http://daringfireball.net/projects/markdown/syntax#link) if you're interested in more info.\r\n\r\n&nbsp;\r\n\r\nRelative links are also supported\r\n\r\n>\\[Relative Link\\]\\(/Assets/Photos/Photos.json\\)\r\n\r\nresults in:\r\n\r\n>[Relative Link](/Assets/Photos/Photos.json)\r\n\r\n&nbsp;\r\n\r\n>\\[Relative Link 2\\]\\(../Photos/Photos.json\\)\r\n\r\nresults in:\r\n\r\n>[Relative Link 2](../Photos/Photos.json)\r\n\r\n**Note:** Relative Links has to be Manually Handled in `LinkClicked` Event.\r\n\r\nCustom Scheme's can be added now using `SchemeList` Property. Scheme's should be separated by a comma( , )\r\n\r\n*Example*:\r\n\r\nIf `SchemeList=\"companyportal,randomscheme\"` then markdown will render\r\n\r\n`companyportal://mycompanyportal.com` to companyportal://mycompanyportal.com\r\n\r\nand\r\n\r\n`randomscheme://www.randomscheme.render` to randomscheme://www.randomscheme.render\r\n\r\n*****\r\n\r\n# Email Links\r\n\r\nEmails can be used as Masked Links or Direct email links.\r\n\r\n>[Email\\]\\(`email@email.com`)\r\n\r\nwill be rendered to [Email](email@email.com)\r\n\r\n>`email@email.com`\r\n\r\nwill be rendered to email@email.com\r\n\r\n*****\r\n\r\n# IMAGES\r\n\r\nTo add an image, it is almost like a link. You just need to add a \\! before.\r\n\r\nSo inline image syntax looks like this:\r\n\r\n>\\!\\[Helpers Image](https\\://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/Microsoft.Toolkit.Uwp.SampleApp/Assets/Helpers.png)\r\n\r\nwhich renders in:\r\n\r\n![Helpers Image](https://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/Microsoft.Toolkit.Uwp.SampleApp/Assets/Helpers.png)\r\n\r\nRendering Images is now supported through prefix. use property **UriPrefix**\r\n\r\n&nbsp;\r\n\r\nExample: if you set **UriPrefix** to **ms-appx://** then\r\n\r\n>\\!\\[Local Image](/Assets/NotificationAssets/Sunny-Square.png)\r\n\r\n&nbsp;\r\n\r\nrenders in\r\n\r\n![Local Image](/Assets/NotificationAssets/Sunny-Square.png)\r\n\r\nYou can also specify image width like this:\r\n\r\n>\\!\\[SVG logo](https\\://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =32) (width is set to 32)\r\n\r\n>\\!\\[SVG logo](https\\://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =x64) (height is set to 64)\r\n\r\n>\\!\\[SVG logo](https\\://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =128x64) (width=128, height=64)\r\n\r\nwhich renders in:\r\n\r\n![SVG logo](https://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =32)\r\n![SVG logo](https://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =x64)\r\n![SVG logo](https://upload.wikimedia.org/wikipedia/commons/0/02/SVG_logo.svg =128x64)\r\n\r\nMarkdownTextblock supports links wrapped with Images.\r\n\r\n>\\[!\\[image](https\\://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/build/nuget.png)](https\\://docs.microsoft.com/windows/uwpcommunitytoolkit/)\r\n\r\nwill render into\r\n\r\n[![image](https://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/build/nuget.png)](https://docs.microsoft.com/windows/uwpcommunitytoolkit/)\r\n\r\nand when clicked will go to the Linked Page.\r\n\r\nMarkdownTextBlock also supports Reference based links.\r\n\r\n```\r\n[![image][1]][2]\r\n\r\n[1]:https://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/build/nuget.png\r\n[2]:https://docs.microsoft.com/windows/uwpcommunitytoolkit/\r\n\r\n```\r\n\r\nwill render into\r\n\r\n[![image][1]][2]\r\n\r\n[1]:https://raw.githubusercontent.com/CommunityToolkit/WindowsCommunityToolkit/main/build/nuget.png\r\n[2]:https://docs.microsoft.com/windows/uwpcommunitytoolkit/\r\n\r\n*****\r\n\r\n# BLOCK QUOTES\r\n\r\nYou'll probably do a lot of quoting of other redditors.  In those cases, you'll want to use block quotes.  Simple begin each line you want quoted with a right angle bracket (>).  Multiple angle brackets can be used for nested quotes.  To cause a new paragraph to be quoted, begin that paragraph with another angle bracket.  So the following:\r\n\r\n    >Quote1\r\n\r\n    >Quote2.1\r\n    >>Quote2.Nest1.1\r\n    >>\r\n    >>Quote2.Nest1.2\r\n    >\r\n    >Quote2.3\r\n\r\n    >Quote3.1\r\n    >Quote3.2\r\n\r\n    >Quote4.1\r\n    >\r\n    >Quote4.2\r\n\r\n    >Quote5.1\r\n    Quote5.2\r\n\r\n    >Quote6\r\n\r\n    Plain text.\r\n\r\n\r\nIs displayed as:\r\n\r\n\r\n>Quote1\r\n\r\n>Quote2.1\r\n>>Quote2.Nest1.1\r\n>>\r\n>>Quote2.Nest1.2\r\n>\r\n>Quote2.3\r\n\r\n>Quote3.1\r\n>Quote3.2\r\n\r\n>Quote4.1\r\n>\r\n>Quote4.2\r\n\r\n>Quote5.1\r\nQuote5.2\r\n\r\n>Quote6\r\n\r\nPlain text.\r\n\r\n*****\r\n\r\n# EMOJIS\r\n\r\nYou can use nearly all emojis from this [list](https://gist.github.com/rxaviers/7360908). Text like `:smile:` will display :smile: emoji.\r\n\r\n*****\r\n\r\n# MISCELLANEOUS\r\n\r\n### Yaml Headers\r\n\r\nThe parsing of YAML metadata is rendered as a form.  For example:\r\n\r\ntitle|date\r\n:-:|:-:\r\nWindows Community Toolkit|2018/10/17\r\n\r\nWhich is produced with the following markdown:\r\n\r\n>`---`\r\n>`title: Windows Community Toolkit`\r\n>`date: 2018/10/17`\r\n>`---`\r\n\r\nWhen you use YAML, you should pay attention to:\r\n\r\n* Must be written at the beginning of the document.\r\n\r\n* The start and end are represented by three short horizontal lines respectively.\r\n\r\n* The format should conform to the YAML specification.\r\n\r\n\r\n\r\n### Tables\r\n\r\nReddit has the ability to represent tabular data in fancy-looking tables.  For example:\r\n\r\nsome|header|labels\r\n:---|:--:|---:\r\nLeft-justified|center-justified|right-justified\r\na|b|c\r\nd|e|f\r\n\r\nWhich is produced with the following markdown:\r\n\r\n>`some|header|labels`\r\n>`:---|:--:|---:`\r\n>`Left-justified|center-justified|right-justified`\r\n>`a|b|c`\r\n>`d|e|f`\r\n\r\nAll you need to produce a table is a row of headers separated by \"pipes\" (**|**), a row indicating how to justify the columns, and 1 or more rows of data (again, pipe-separated).\r\n\r\nThe only real \"magic\" is in the row between the headers and the data.  It should ideally be formed with rows dashes separated by pipes.  If you add a colon to the left of the dashes for a column, that column will be left-justified.  To the right for right justification, and on both sides for centered data.  If there's no colon, it defaults to left-justified.\r\n\r\nAny number of dashes will do, even just one.  You can use none at all if you want it to default to left-justified, but it's just easier to see what you're doing if you put a few in there.\r\n\r\nAlso note that the pipes (signifying the dividing line between cells) don't have to line up.  You just need the same number of them in every row.\r\n\r\n### Escaping special characters\r\n\r\nIf you need to display any of the special characters, you can escape that character with a backslash (\\\\).  For example:\r\n\r\n>Escaped \\\\\\*italics\\\\\\*\r\n\r\nresults in:\r\n\r\n>Escaped \\*italics\\*\r\n\r\n###Horizontal rules\r\n\r\nFinally, to create a horizontal rule, create a separate paragraph with 5 or more asterisks (\\*).\r\n\r\n>\\*\\*\\*\\*\\*\r\n\r\nresults in\r\n\r\n>*****\r\n\r\nSource: https://www.reddit.com/r/reddit.com/comments/6ewgt/reddit_markdown_primer_or_how_do_you_do_all_that/c03nik6\r\n";

        public DocumentView()
        {
            this.InitializeComponent();

            SharedShadow.Receivers.Add(BackgroundGrid);
            ToolBar.Translation += new Vector3(0, 0, 16);
            MarkdownGrid.Translation += new Vector3(0, 0, 16);
        }

        public DocumentViewModel ViewModel = new();
    }
}
